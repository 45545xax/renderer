#include "constant_models.h"
#include <stddef.h>
#include <stdio.h>
#include "../core/apis.h"
#include "../shaders/constant_shader.h"

model_t **constant_mccree_models(void) {
    mat4_t transforms[8] = {
        {{
            {0.186340f, 0.000000f, 0.000000f, -0.006200f},
            {0.000000f, 0.000000f, 0.186340f, 0.131450f},
            {0.000000f, -0.186340f, 0.000000f, -0.010720f},
            {0.000000f, 0.000000f, 0.000000f, 1.000000f},
        }},
        {{
            {0.239850f, 0.008740f, 0.004060f, -0.014310f},
            {-0.020360f, 0.034120f, 0.052410f, 2.016510f},
            {0.008460f, -0.165570f, 0.011010f, -0.055260f},
            {0.000000f, 0.000000f, 0.000000f, 1.000000f},
        }},
        {{
            {0.287440f, -0.019260f, 0.000000f, -0.008370f},
            {-0.007360f, -0.108460f, -0.010090f, 2.267050f},
            {-0.017800f, -0.266190f, 0.004110f, -0.083880f},
            {0.000000f, 0.000000f, 0.000000f, 1.000000f},
        }},
        {{
            {-0.039080f, -0.003570f, 0.033020f, 0.279880f},
            {-0.009790f, -0.000520f, -0.132230f, 1.397640f},
            {-0.003590f, 0.040280f, 0.001210f, 0.006560f},
            {0.000000f, 0.000000f, 0.000000f, 1.000000f},
        }},
        {{
            {-0.039130f, -0.006760f, 0.025830f, 0.252460f},
            {-0.006030f, -0.009210f, -0.131150f, 1.364990f},
            {-0.008250f, 0.038800f, -0.026640f, -0.108820f},
            {0.000000f, 0.000000f, 0.000000f, 1.000000f},
        }},
        {{
            {-0.039130f, -0.006760f, 0.025830f, 0.182500f},
            {-0.006030f, -0.009210f, -0.131150f, 1.340350f},
            {-0.008250f, 0.038800f, -0.026640f, -0.178540f},
            {0.000000f, 0.000000f, 0.000000f, 1.000000f},
        }},
        {{
            {-0.019630f, -0.037890f, 0.016320f, 0.498480f},
            {-0.013760f, -0.058690f, -0.014030f, 1.926990f},
            {-0.031050f, 0.049970f, -0.004100f, 0.389470f},
            {0.000000f, 0.000000f, 0.000000f, 1.000000f},
        }},
        {{
            {-0.000780f, 0.023700f, 0.000570f, -0.440940f},
            {-0.004270f, -0.000700f, 0.023330f, 0.955610f},
            {-0.023320f, -0.000670f, -0.004290f, 0.163730f},
            {0.000000f, 0.000000f, 0.000000f, 1.000000f},
        }},
    };
    constant_material_t materials[28] = {
        {{0.342f, 0.130f, 0.184f, 1}},
        {{0.440f, 0.165f, 0.233f, 1}},
        {{0.509f, 0.191f, 0.270f, 1}},
        {{0.156f, 0.044f, 0.068f, 1}},
        {{0.098f, 0.708f, 1.000f, 1}, {0.020f, 0.142f, 0.200f, 1}},
        {{0.132f, 0.240f, 0.131f, 1}},
        {{0.699f, 0.018f, 0.005f, 1}, {0.632f, 0.006f, 0.000f, 1}},
        {{1.000f, 0.151f, 0.020f, 1}},
        {{0.027f, 0.115f, 0.089f, 1}},
        {{1.000f, 1.000f, 1.000f, 1}, {0.184f, 0.184f, 0.184f, 1}},
        {{0.080f, 0.017f, 0.039f, 1}},
        {{0.152f, 0.028f, 0.041f, 1}},
        {{0.578f, 0.076f, 0.053f, 1}},
        {{0.922f, 0.521f, 0.352f, 1}},
        {{0.376f, 0.048f, 0.041f, 1}},
        {{0.941f, 0.613f, 0.463f, 1}},
        {{0.869f, 0.635f, 0.438f, 1}},
        {{0.528f, 0.320f, 0.147f, 1}},
        {{0.665f, 0.347f, 0.242f, 1}},
        {{0.448f, 0.227f, 0.153f, 1}},
        {{0.091f, 0.015f, 0.031f, 1}},
        {{0.168f, 0.027f, 0.056f, 1}},
        {{0.168f, 0.025f, 0.031f, 1}},
        {{0.847f, 0.202f, 0.216f, 1}},
        {{0.638f, 0.136f, 0.147f, 1}},
        {{0.658f, 0.156f, 0.171f, 1}},
        {{0.260f, 0.036f, 0.046f, 1}},
        {{1.000f, 0.625f, 0.292f, 1}},
    };
    int mesh2transform[46] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 1, 1, 1, 1, 1, 2, 2, 3, 3, 3, 4, 4,
        4, 5, 5, 5, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7,
    };
    int mesh2material[46] = {
        17, 13, 18, 19, 20, 21, 3, 11, 22, 23, 24, 25, 0, 4, 26, 2,
        1, 6, 9, 27, 12, 13, 14, 15, 16, 3, 11, 10, 4, 1, 10, 4,
        1, 10, 4, 1, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4,
    };
    const char *obj_format = "assets/mccree/part%d.obj";
    char obj_buffer[128];
    model_t **models = NULL;
    model_t *model;
    mat4_t scale, translation, root;
    int i;

    translation = mat4_translate(0.111f, -1.479f, 0.033f);
    scale = mat4_scale(0.674f, 0.674f, 0.674f);
    root = mat4_mul_mat4(scale, translation);
    for (i = 0; i < 44; i++) {
        int transform_index = mesh2transform[i];
        mat4_t transform = mat4_mul_mat4(root, transforms[transform_index]);
        int material_index = mesh2material[i];
        constant_material_t material = materials[material_index];
        sprintf(obj_buffer, obj_format, i);
        model = constant_create_model(transform, obj_buffer, material);
        darray_push(models, model);
    }

    return models;
}

void constant_release_models(model_t **models) {
    int num_models = darray_size(models);
    int i;
    for (i = 0; i < num_models; i++) {
        constant_release_model(models[i]);
    }
    darray_free(models);
}
